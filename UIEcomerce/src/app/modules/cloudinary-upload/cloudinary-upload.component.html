<!-- cloudinary-upload.component.html -->
<div class="w-full max-w-6xl mx-auto p-6">
  <!-- Área de Drag & Drop -->
  <div
    class="border-2 border-dashed border-gray-300 rounded-xl p-12 text-center transition-all duration-300 ease-in-out hover:border-blue-400 hover:bg-blue-50 cursor-pointer"
    [class.border-blue-500]="isDragging"
    [class.bg-blue-50]="isDragging"
    [class.border-green-400]="!isDragging && uploadedImages.length > 0"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    (click)="onUploadAreaClick()"
  >
    <input
      #fileInput
      type="file"
      [accept]="acceptedTypes"
      (change)="onFileSelected($event)"
      class="hidden"
    />

    <div class="space-y-6">
      <!-- Ícono -->
      <div class="flex justify-center">
        <div class="p-4 bg-blue-100 rounded-full">
          <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
            </path>
          </svg>
        </div>
      </div>

      <!-- Texto Principal -->
      <div class="space-y-2">
        <p class="text-xl font-bold text-gray-800">
          Subir la imágen de tu producto
        </p>
        <p class="text-gray-600">
          Arrastra tus imágenes aquí o haz clic para buscarlas
        </p>
      </div>

      <!-- Especificaciones -->
      <div class="inline-flex flex-col items-center space-y-1 text-sm text-gray-500 bg-white rounded-lg px-4 py-2">
        <div class="flex items-center space-x-4">
          <span>Formatos: JPG, PNG, GIF, WebP, SVG</span>
          <span>•</span>
          <span>Máx. 5MB</span>
          <span>•</span>
          <span>Máx. {{ maxFiles }} archivo</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Lista de Imágenes Subidas -->
  <div class="mt-8 space-y-6" *ngIf="uploadedImages.length > 0">
    <!-- Header -->
    <div class="flex justify-between items-center">
      <h3 class="text-xl font-semibold text-gray-800">
        Imágenes Subidas
      </h3>
      <div class="text-sm text-gray-600">
        <!-- {{ uploadedImages.filter(img => img.status === 'completed').length }}/{{ uploadedImages.length }} completadas -->
      </div>
    </div>

    <!-- Grid de Imágenes -->
    <div class="grid grid-cols-1 ">
      <div
        *ngFor="let image of uploadedImages; let i = index"
        class="bg-white border-2 rounded-xl overflow-hidden shadow-sm transition-all duration-200 hover:shadow-lg"
        [class]="getStatusClass(image.status) + ' border-l-4'"
      >
        <!-- Preview de la Imagen -->
        <div class="relative aspect-video bg-gray-100">
          <img
            *ngIf="image.url"
            [src]="image.url"
            [alt]="image.name"
            class="w-full h-full object-cover"
          />
          <!-- Overlay de Estado -->
          <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center"
               *ngIf="image.status === 'uploading'">
            <div class="text-center text-white">
              <svg class="w-8 h-8 animate-spin mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                </path>
              </svg>
              <p class="text-sm font-medium">{{ image.progress }}%</p>
            </div>
          </div>

          <!-- Overlay de Acciones -->
          <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center opacity-0 hover:opacity-100">
            <div class="flex space-x-2">

              <!-- <button
              (click)="updateImage(image.public_id); $event.stopPropagation()"
              (change)="onFileSelected($event)"
              >
                  <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                      <linearGradient id="refreshGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#3B82F6"/>
                        <stop offset="100%" stop-color="#1D4ED8"/>
                      </linearGradient>
                    </defs>
                    <path d="M6 6V12H6.77536M26.5841 14.6667C25.928 9.40492 21.4395 5.33334 16 5.33334C11.5235 5.33334 7.69105 8.09089 6.10869 12M6.10869 12H12M26.6667 26.6667V20H25.8913M25.8913 20C24.3089 23.9091 20.4765 26.6667 16 26.6667C10.5605 26.6667 6.07199 22.5951 5.41587 17.3333M25.8913 20H20"
                          stroke="url(#refreshGradient)"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"/>
                  </svg>
              </button> -->
              <!-- Botón Eliminar -->
              <button
                (click)="removeImage(image.public_id!); $event.stopPropagation()"
                class="p-3 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg"
                title="Eliminar imagen"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                  </path>
                </svg>
              </button>

              <!-- Botón Reintentar -->
              <button
                *ngIf="image.status === 'error'"
                (click)="retryUpload(image); $event.stopPropagation()"
                class="p-3 bg-yellow-500 text-white rounded-full hover:bg-yellow-600 transition-colors shadow-lg"
                title="Reintentar subida"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                  </path>
                </svg>
              </button>

              <!-- Botón Copiar URL -->
              <button
                *ngIf="image.status === 'completed'"
                (click)="copyUrl(image); $event.stopPropagation()"
                class="p-3 bg-green-500 text-white rounded-full hover:bg-green-600 transition-colors shadow-lg"
                title="Copiar URL de Cloudinary"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                  </path>
                </svg>
              </button>
            </div>
          </div>

          <!-- Badge de Estado -->
          <div class="absolute top-3 right-3">
            <span class="px-3 py-1 text-xs font-semibold rounded-full shadow-md" [class]="getStatusClass(image.status)">
              <svg class="w-3 h-3 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="getStatusIcon(image.status)"></path>
              </svg>
              {{ getStatusText(image.status) }}
            </span>
          </div>
        </div>

        <!-- Información del Archivo -->
        <div class="p-4 space-y-3">
          <!-- Nombre y Tamaño -->
          <div>
            <h4 class="text-sm font-semibold text-gray-900 truncate" [title]="image.name">
              {{ image.name }}
            </h4>
            <p class="text-xs text-gray-500 mt-1">
              {{ formatFileSize(image.size) }} • {{ image.uploadDate | date:'dd/MM/yyyy HH:mm' }}
            </p>
          </div>

          <!-- Barra de Progreso -->
          <div *ngIf="image.status === 'uploading'" class="space-y-2">
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div
                class="bg-blue-500 h-2 rounded-full transition-all duration-300 shadow-sm"
                [style.width]="image.progress + '%'"
              ></div>
            </div>
            <p class="text-xs text-gray-600 text-right">
              {{ image.progress }}% subido
            </p>
          </div>

          <!-- URL de Cloudinary -->
          <div *ngIf="image.status === 'completed' && image.secure_url" class="bg-gray-50 rounded-lg p-2">
            <p class="text-xs text-gray-600 break-all line-clamp-2" [title]="image.secure_url">
              {{ image.secure_url }}
            </p>
          </div>

          <!-- Mensaje de Error -->
          <div *ngIf="image.status === 'error' && image.error" class="bg-red-50 rounded-lg p-2">
            <p class="text-xs text-red-700">{{ image.error }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Estado Vacío -->
  <div *ngIf="uploadedImages.length === 0" class="mt-12 text-center py-12">
    <div class="max-w-md mx-auto">
      <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
        </path>
      </svg>
      <p class="text-gray-500 text-lg">No hay imágenes subidas todavía</p>
    </div>
  </div>
</div>
